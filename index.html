<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analýza Referreru a Pozice Myši</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #555;
            font-size: 1.2em;
        }
        span {
            font-weight: bold;
            color: #007BFF;
        }
    </style>
</head>
<body>
    <h1>Informace o příchodu na stránku</h1>
    <h2 id="referrer-info">Referrer: <span>Načítání...</span></h2>
    <h2 id="mouse-position-info">Počáteční pozice myši: <span>Čekání na pohyb...</span></h2>
    <h2 id="webdriver-info">navigator.webdriver: <span>Načítání...</span></h2>

    <script>
        // --- Zjištění Referreru pomocí Performance API ---
        function getReferrer() {
            const referrerInfoElement = document.getElementById('referrer-info').querySelector('span');

            if (window.performance && window.performance.getEntriesByType) {
                const navigationEntries = window.performance.getEntriesByType("navigation");
                if (navigationEntries.length > 0) {
                    const referrer = navigationEntries[0].referrer;
                    referrerInfoElement.textContent = referrer || "Přímý přístup (žádný referrer)";
                } else {
                    referrerInfoElement.textContent = "Data navigace nejsou k dispozici.";
                }
            } else {
                referrerInfoElement.textContent = document.referrer || "Přímý přístup (žádný referrer)";
            }
        }

        // --- Zjištění úvodní pozice myši ---
        function getInitialMousePosition() {
            const mousePositionInfoElement = document.getElementById('mouse-position-info').querySelector('span');

            const handleFirstMove = (event) => {
                const x = event.clientX;
                const y = event.clientY;
                const vw = window.innerWidth;
                const vh = window.innerHeight;

                let positionDescription = `X: ${x}, Y: ${y}`;
                const tolerance = 50;

                if (y < tolerance) {
                    if (x < tolerance) {
                        positionDescription = "Levý horní roh";
                    } else if (x > vw - tolerance) {
                        positionDescription = "Pravý horní roh";
                    } else {
                        positionDescription = "U horní hrany";
                    }
                } else if (y > vh - tolerance) {
                    if (x < tolerance) {
                        positionDescription = "Levý dolní roh";
                    } else if (x > vw - tolerance) {
                        positionDescription = "Pravý dolní roh";
                    } else {
                        positionDescription = "U dolní hrany";
                    }
                } else if (Math.abs(x - vw / 2) < tolerance && Math.abs(y - vh / 2) < tolerance) {
                    positionDescription = "Uprostřed stránky";
                } else if (x < tolerance) {
                    positionDescription = "U levé hrany";
                } else if (x > vw - tolerance) {
                    positionDescription = "U pravé hrany";
                }

                mousePositionInfoElement.textContent = positionDescription;
                document.removeEventListener('mousemove', handleFirstMove);
            };

            document.addEventListener('mousemove', handleFirstMove);
        }

        // --- Kontrola navigator.webdriver a případného přepsání ---
        function checkWebdriver() {
            const webdriverInfoElement = document.getElementById('webdriver-info').querySelector('span');

            const descProto = Object.getOwnPropertyDescriptor(Navigator.prototype, 'webdriver');
            const descInstance = Object.getOwnPropertyDescriptor(window.navigator, 'webdriver');
            const currentValue = navigator.webdriver;

            let status = `Aktuální hodnota: ${currentValue}`;
            let tampering = false;

            // Kontrola, jestli byla vlastnost odstraněna z prototypu
            if (!descProto && descInstance) {
                status += " | Vlastnost byla odstraněna z prototypu a ručně přidána na instanci.";
                tampering = true;
            } else if (descProto) {
                const isNativeGetter = descProto.get && descProto.get.toString().includes('[native code]');
                if (!isNativeGetter) {
                    status += " | Getter na prototypu byl přepsán skriptem.";
                    tampering = true;
                }
            }

            // Pokud je hodnota false a detekujeme zásah
            if (currentValue === false && tampering) {
                status += " | Původní hodnota pravděpodobně byla true a někdo ji přepsal na false.";
            } else if (!tampering) {
                status += " | Hodnota je původní (bez úprav).";
            }

            webdriverInfoElement.textContent = status;
        }

        window.onload = () => {
            getReferrer();
            getInitialMousePosition();
            checkWebdriver();
        };
    </script>
</body>
</html>
